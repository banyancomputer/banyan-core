{
  "db_name": "SQLite",
  "query": "WITH current_grants AS (\n            SELECT id, storage_host_id, user_id, MAX(redeemed_at) AS most_recently_redeemed_at\n            FROM storage_grants\n            WHERE redeemed_at IS NOT NULL AND user_id = $1\n            GROUP BY storage_host_id, user_id\n        )\n            SELECT sg.id AS storage_grant_id, sg.authorized_amount, sh.name AS storage_host_name, sh.url AS storage_host_url\n                FROM current_grants AS cg\n                JOIN storage_hosts_metadatas_storage_grants AS shms ON shms.storage_grant_id = cg.id\n                JOIN storage_hosts AS sh ON sh.id = shms.storage_host_id\n                JOIN metadata AS m ON m.id = shms.metadata_id\n                JOIN buckets AS b ON b.id = m.bucket_id\n                JOIN storage_grants AS sg ON sg.id = cg.id\n                WHERE b.user_id = $1 \n                    AND b.id = $2\n                    AND b.deleted_at IS NOT NULL\n                    AND m.state NOT IN ('deleted', 'upload_failed');",
  "describe": {
    "columns": [
      {
        "name": "storage_grant_id",
        "ordinal": 0,
        "type_info": "Text"
      },
      {
        "name": "authorized_amount",
        "ordinal": 1,
        "type_info": "Int64"
      },
      {
        "name": "storage_host_name",
        "ordinal": 2,
        "type_info": "Text"
      },
      {
        "name": "storage_host_url",
        "ordinal": 3,
        "type_info": "Text"
      }
    ],
    "parameters": {
      "Right": 2
    },
    "nullable": [
      false,
      false,
      false,
      false
    ]
  },
  "hash": "ff42395709b5beeb03c9d099cb5055981e18d024342537ded458a2559a9a975f"
}

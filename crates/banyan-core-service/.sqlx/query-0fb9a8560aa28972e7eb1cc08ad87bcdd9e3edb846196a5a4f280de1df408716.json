{
  "db_name": "SQLite",
  "query": "SELECT bl.block_id, bl.metadata_id, bl.storage_host_id, COALESCE(CAST(COUNT(DISTINCT bl.storage_host_id) AS BIGINT), 0) as host_count\n            FROM block_locations bl\n                 JOIN blocks b ON bl.block_id = b.id\n                 JOIN metadata m ON bl.metadata_id = m.id\n                 JOIN buckets bu ON m.bucket_id = bu.id\n                 JOIN users u ON bu.user_id = u.id\n                 LEFT JOIN block_locations bl2 ON bl.block_id = bl2.block_id\n                    AND bl2.storage_host_id = (SELECT id FROM storage_hosts WHERE staging IS TRUE)\n                    OR bl2.stored_at IS NULL\n            WHERE bl2.block_id IS NULL\n              AND bl.pruned_at IS NULL\n              AND bl.expired_at IS NULL\n              AND bu.deleted_at IS NULL\n              AND NOT EXISTS (\n                  SELECT 1 FROM block_locations bl3\n                  WHERE bl3.metadata_id = bl.metadata_id\n                  AND bl3.storage_host_id = (SELECT id FROM storage_hosts WHERE staging IS TRUE)\n              )\n            GROUP BY bl.block_id, bl.storage_host_id;",
  "describe": {
    "columns": [
      {
        "name": "block_id",
        "ordinal": 0,
        "type_info": "Text"
      },
      {
        "name": "metadata_id",
        "ordinal": 1,
        "type_info": "Text"
      },
      {
        "name": "storage_host_id",
        "ordinal": 2,
        "type_info": "Text"
      },
      {
        "name": "host_count",
        "ordinal": 3,
        "type_info": "Null"
      }
    ],
    "parameters": {
      "Right": 0
    },
    "nullable": [
      false,
      false,
      false,
      null
    ]
  },
  "hash": "0fb9a8560aa28972e7eb1cc08ad87bcdd9e3edb846196a5a4f280de1df408716"
}

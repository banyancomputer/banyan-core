{
  "db_name": "SQLite",
  "query": "SELECT bl.block_id, bl.metadata_id, bl.storage_host_id, COUNT(DISTINCT bl.storage_host_id) as host_count\n            FROM block_locations bl\n                 JOIN blocks b ON bl.block_id = b.id\n                 JOIN metadata m ON bl.metadata_id = m.id\n                 JOIN buckets bu ON m.bucket_id = bu.id\n                 JOIN users u ON bu.user_id = u.id\n                 LEFT JOIN block_locations bl2 ON bl.block_id = bl2.block_id\n                    AND bl2.storage_host_id = (SELECT id FROM storage_hosts WHERE staging IS TRUE)\n                    OR bl2.stored_at IS NULL\n            WHERE bl2.block_id IS NULL\n              AND bl.pruned_at IS NULL\n              AND bl.expired_at IS NULL\n              AND bu.deleted_at IS NULL\n            GROUP BY bl.block_id, bl.storage_host_id\n            HAVING host_count < bu.replicas;",
  "describe": {
    "columns": [
      {
        "name": "block_id",
        "ordinal": 0,
        "type_info": "Text"
      },
      {
        "name": "metadata_id",
        "ordinal": 1,
        "type_info": "Text"
      },
      {
        "name": "storage_host_id",
        "ordinal": 2,
        "type_info": "Text"
      },
      {
        "name": "host_count",
        "ordinal": 3,
        "type_info": "Int64"
      }
    ],
    "parameters": {
      "Right": 0
    },
    "nullable": [
      false,
      false,
      false,
      false
    ]
  },
  "hash": "d8f0a3eafd33c59acb19158e8e5740988e93e46133a1fd5fd0ff5cd18e55495c"
}

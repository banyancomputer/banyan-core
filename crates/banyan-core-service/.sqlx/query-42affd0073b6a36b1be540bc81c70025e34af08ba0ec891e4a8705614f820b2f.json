{
  "db_name": "SQLite",
  "query": "WITH current_grants AS (\n               SELECT storage_host_id, account_id, MAX(redeemed_at) AS most_recently_redeemed_at\n                   FROM storage_grants\n                   GROUP BY storage_host_id, account_id\n           )\n           SELECT sg.authorized_amount, sh.url as storage_host_url\n               FROM buckets AS b\n               JOIN metadata AS m ON m.bucket_id = b.id\n               JOIN storage_hosts_metadatas_storage_grants AS shms ON shms.metadata_id = m.id\n               JOIN storage_hosts AS sh ON sh.id = shms.storage_host_id\n               JOIN storage_grants AS sg ON sg.id = shms.storage_grant_id\n               JOIN current_grants AS cg ON cg.storage_host_id = sh.id\n                   AND cg.account_id = sg.account_id\n                   AND cg.most_recently_redeemed_at = sg.redeemed_at\n               WHERE b.account_id = $1\n                   AND b.id = $2\n                   AND m.state NOT IN ('deleted', 'upload_failed');",
  "describe": {
    "columns": [
      {
        "name": "authorized_amount",
        "ordinal": 0,
        "type_info": "Int64"
      },
      {
        "name": "storage_host_url",
        "ordinal": 1,
        "type_info": "Text"
      }
    ],
    "parameters": {
      "Right": 2
    },
    "nullable": [
      false,
      false
    ]
  },
  "hash": "42affd0073b6a36b1be540bc81c70025e34af08ba0ec891e4a8705614f820b2f"
}
